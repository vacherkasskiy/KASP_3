# Тестовое задание KASPERSKY №3 (усложненная версия)

## Условие

В компании работает несколько сервисов. Для удобства поддержки эти сервисы пишут логи в виде текстовых файлов. Для быстрой и удобной обработки файлы с логами ротируются. То есть, когда размер файла лога превышает некоторый порог в S байт, он переименовывается с добавлением номера ротации в конец имени файла, а текущий лог направляется в новый файл. Для экономии места система хранит не больше N ротации для каждого сервиса.

Формат логов
> Имя текущего файла логов для сервиса: <service_name>.log, где service_name – имя сервиса.  
>
>Имя предыдущих файлов логов для сервиса: <service_name>.<rotation_number>.log, где rotation_number, равный 1 – самый старый файл логов, а равный N – предыдущий файл логов. Например: AwesomeService.13.log.

Формат записи лога:
```
[Timestamp][Severity][Category] Message
```

Пример:
```
[01.10.2023 12:00:00.813][Info][RequestHandler] Request #69 with 24 items received from user example@domain.com
[01.10.2023 12:00:01.119][Warning][RequestPayloadProcessor] Request #69 contains unsupported items
```

Задача  
Реализовать сервис, генерирующий отчёты по логам сервисов.

На вход должен подаваться запрос на поиск по имени сервиса (с поддержкой регулярных выражений). Запрос также содержит путь к директории с файлами логов.

В ответ сервис возвращает коллекцию отчётов, для всех сервисов, попадающих под условия поиска.



Структура отчёта:
- Имя сервиса
- Дата и время самой ранней записи в логах
- Дата и время самой последней записи в логах
- Количество записей в разрезе severity (абсолютные значения и в % от общего количества)
- Количество записей в разрезе category (абсолютные значения и в % от общего количества)
- Количество ротаций.



Форма реализации: REST API сервис или консольное приложение.  
Требования со звёздочкой (опциональные)
- Асинхронная реализация: запрос не блокирует клиента в ожидании, а получает идентификатор задачи, и предоставляется возможность периодически узнать статус готовности отчёта
- Возможность посмотреть статус системы – количество запущенных задач и их идентификаторы (при выполнении предыдущего требования)
- Загрузка логов в систему с анонимизацией персональных данных (адресов электронной почты: example@domain.com -> e*a*p*e@domain.com)

## Руководство по использованию

- Клонировать репозиторий себе на ПК
- Открыть решение в любой IDE, поддерживающей язык C#
- Запустить проект `report_service`
- Воспользоваться интересующим эндпоинтом

Пример `add_task` запроса:
```
{
  "serviceName": "[a-zA-Z]",
  "logsPath": "C:\\Users\\user1\\OneDrive\\Рабочий стол\\logs"
}
```
> Created task with ID: 1  

Пример URL `task_status` запроса:
`https://localhost:7203/report_generator/task_status?taskId=1`

```
======= REPORT =======
Service name: dflbbdfl
Earliest log time: 03.10.2023 18:12:33
Latest log time: 03.10.2023 18:12:33
Severity slice info: Error: 3 (100%); 
Category slice info: RequestHandler: 3 (100%); 
Rotations amount: 0
======================

======= REPORT =======
Service name: service
Earliest log time: 01.10.2023 12:00:00
Latest log time: 05.10.2023 10:46:14
Severity slice info: Info: 6 (54%); Warning: 2 (18%); Error: 3 (27%); 
Category slice info: RequestHandler: 7 (63%); RequestPayloadProcessor: 2 (18%); Database: 2 (18%); 
Rotations amount: 4
======================
```

## Примечания:

- Необходимо вводить абсолютный путь до директории с логами в виде `C:\\Documents\\folder1\\folder2`
- Вместо имени сервиса можно подавать регулярное выражение